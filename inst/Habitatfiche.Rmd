---
title: "Habitatfiche"
date: "`r Sys.Date()`"
output: html_document
---


```{r setupChild, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r librariesChild, include=FALSE}

library(xtable)
library(tidyr)
library(LSVI)
library(dplyr)

```



```{r inladen_gegevens}
# versie <- "Versie 3"
# habitatsubtype <- "4010"
# ConnectieLSVIhabitats <- connecteerMetLSVIdb()

Habitatfiche <- geefInfoHabitatfiche(ConnectieLSVIhabitats = ConnectieLSVIhabitats, Versie = versie, 
                                     Habitatsubtype = habitatsubtype)

Versie <- geefVersieInfo(ConnectieLSVIhabitats) %>%
  filter_(~VersieLSVI == versie)

```


####Habitatsubtype `r Habitatfiche[1,"Habitatsubtype"]`: `r Habitatfiche[1,"Habitatsubtypenaam"]`

#####Habitatkarakteristieken

```{r habitatkarakteristieken, results='asis'}

Habitatkarakteristieken <- Habitatfiche %>%
  select_(Criterium = ~Criterium.habitat, Indicator = ~Indicator.habitat,
          ~Beschrijving, ~Maatregelen, Opmerkingen = ~Opmerkingen.habitat,
          Referenties = ~Referenties.habitat) %>%
  distinct_()

for(criterium in unique(Habitatkarakteristieken$Criterium)){
  cat(criterium)
  Habitattabel <- Habitatkarakteristieken %>%
    filter_(~Criterium == criterium) %>%
    select_(
      ~ Indicator, 
      ~ Beschrijving, 
      ~ Maatregelen, 
      ~ Opmerkingen, 
      ~ Referenties
    ) %>%
    xtable(digits = ncol(.))
  print(Habitattabel, type = "html", include.rownames = FALSE)
}

```


#####Beoordelingsmatrix

```{r beoordelingsmatrix, results='asis', message=FALSE, warning=FALSE}

Beoordelingsfiche <- Habitatfiche %>%
  select_(~Beoordeling, Criterium = ~Criterium.beoordeling, Indicator = ~Indicator.beoordeling, 
          Opmerkingen = ~Opmerkingen.beoordeling, Referenties = ~Referenties.beoordeling,
          ~Kwaliteitsniveau) %>%
  distinct_() %>%
  inner_join(data.frame(Kwaliteitsniveau=c(1,2), Referentieniveau = c(Versie$Kwaliteitsniveau1,Versie$Kwaliteitsniveau2), stringsAsFactors = FALSE)) %>%
  select(-Kwaliteitsniveau)%>%
  spread(key = Referentieniveau, value = Beoordeling)

for(Criterium in unique(Habitatfiche$Criterium.beoordeling)){   #hier wordt Criterium in Habitatfiche gebruikt omdat deze volgorde juist staat
  cat(Criterium)
  Beoordelingsmatrix <- 
    xtable(Beoordelingsfiche[Beoordelingsfiche$Criterium==Criterium,
                        c("Indicator","Gunstige staat","Streefwaarde","Opmerkingen","Referenties")])
  print(Beoordelingsmatrix, type = "html", include.rownames = FALSE)
}

```


