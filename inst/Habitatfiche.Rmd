---
title: "Habitatfiche"
date: "`r Sys.Date()`"
output: html_document
params: 
  Versie: "Versie 3"
  Habitatsubtype: "4010"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, include=FALSE}
library(dplyr)
library(LSVI)
library(xtable)
library(tidyr)

```



```{r inladen_gegevens}


Habitatfiche <- geefInfoHabitatfiche(Versie = params$Versie, Habitatsubtype = params$Habitatsubtype)

Versie <- geefVersieInfo() %>%
  filter_(~VersieLSVI == params$Versie)

```


##Habitattype `r Habitatfiche[1,"Habitatcode_subtype"]`: `r Habitatfiche[1,"Habitatnaam_subtype"]`

###Habitatkarakteristieken

```{r habitatkarakteristieken, results='asis'}

Habitatkarakteristieken <- Habitatfiche %>%
  select_(Criterium = ~Criterium.habitat, Indicator = ~Indicator.habitat,
          ~Beschrijving, ~Maatregelen, Opmerkingen = ~Opmerkingen.habitat,
          Referenties = ~Referenties.habitat) %>%
  distinct_()

for(criterium in unique(Habitatkarakteristieken$Criterium)){
  cat(criterium)
  Habitattabel <- Habitatkarakteristieken %>%
    filter_(~Criterium == criterium) %>%
    select_(
      ~ Indicator, 
      ~ Beschrijving, 
      ~ Maatregelen, 
      ~ Opmerkingen, 
      ~ Referenties
    ) %>%
    xtable(digits = ncol(.))
  print(Habitattabel, type = "html", include.rownames = FALSE)
}

```


###Beoordelingsmatrix

```{r beoordelingsmatrix, results='asis', message=FALSE, warning=FALSE}

Beoordelingsfiche <- Habitatfiche %>%
  select_(~Beoordeling, Criterium = ~Criterium.beoordeling, Indicator = ~Indicator.beoordeling, 
          Opmerkingen = ~Opmerkingen.beoordeling, Referenties = ~Referenties.beoordeling,
          ~Kwaliteitsniveau) %>%
  distinct_() %>%
  inner_join(data.frame(Kwaliteitsniveau=c(1,2), Referentieniveau = c(Versie$Kwaliteitsniveau1,Versie$Kwaliteitsniveau2), stringsAsFactors = FALSE)) %>%
  select(-Kwaliteitsniveau)%>%
  spread(key = Referentieniveau, value = Beoordeling)

for(Criterium in unique(Habitatfiche$Criterium.beoordeling)){   #hier wordt Criterium in Habitatfiche gebruikt omdat deze volgorde juist staat
  cat(Criterium)
  Beoordelingsmatrix <- 
    xtable(Beoordelingsfiche[Beoordelingsfiche$Criterium==Criterium,
                        c("Indicator","Gunstige staat","Streefwaarde","Opmerkingen","Referenties")])
  print(Beoordelingsmatrix, type = "html", include.rownames = FALSE)
}

```


